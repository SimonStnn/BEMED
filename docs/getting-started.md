# Getting Started Guide for System Administrators

## Overview

This guide provides step-by-step instructions for setting up and maintaining the BEMED Zero Waste Management System. It is designed for system administrators who are responsible for deploying and managing the application.

## Prerequisites

Before you begin, ensure you have the following prerequisites installed on your system:

- **Docker** (version 20.10.0 or higher)
- **Docker Compose** (version 2.0.0 or higher)
- **Git** (optional, for cloning the repository)

You can verify your Docker and Docker Compose installations with:

```bash
docker --version
docker-compose --version
```

## System Requirements

- **CPU**: Minimum 2 cores, recommended 4 cores
- **RAM**: Minimum 4GB, recommended 8GB
- **Storage**: Minimum 10GB free space, recommended 20GB
- **Network**: Stable internet connection with open ports 80 and 443
- **Operating System**: Linux (recommended), macOS, or Windows with WSL2

## Installation

### Step 1: Clone or Download the Repository

```bash
git clone https://github.com/SimonStnn/BEMED.git
cd BEMED
```

Alternatively, you can download and extract the ZIP file from the repository.

### Step 2: Configure Environment Variables

Create a `.env` file in the root directory of the project with the following configuration:

```conf
# Domain configuration
BEMED_DOMAIN=your-domain.com  # Use "localhost" for local development
DNS_PREFIX_KEYCLOAK=keycloak
DNS_PREFIX_BEMED_BACKEND=api
DNS_PREFIX_BEMED_FRONTEND=app
BEMED_PROTOCOL=https  # Use "http" for local development
NODE_ENV=production  # Use "development" for local development

# API configuration
BEMED_API_PORT=3000

# Database configuration
MARIADB_ROOT_PASSWORD=your_secure_password  # Change this to a strong password

# Keycloak configuration
KC_BOOTSTRAP_ADMIN_USERNAME=admin  # Change this for production
KC_BOOTSTRAP_ADMIN_PASSWORD=strong_admin_password  # Change this for production
KC_DB_USERNAME=keycloak
KC_DB_PASSWORD=keycloak_db_password  # Change this for production
KC_DB_NAME=keycloak

# Client configuration
KEYCLOAK_REALM=BEMED
KEYCLOAK_BACKEND_CLIENT_ID=backend
KEYCLOAK_FRONTEND_CLIENT_ID=frontend
KEYCLOAK_CLIENT_SECRET=your_client_secret  # Will be generated by Keycloak

# Optional: Set UID and GID for Docker containers (Linux/macOS)
UID=1000
GID=1000
```

Customize the values according to your environment. For production deployments, ensure all passwords are strong and unique.

### Step 3: Start the Application

Start all services using Docker Compose:

```bash
docker-compose up -d
```

This command builds and starts all the required containers in detached mode. The first build may take several minutes to complete.

### Step 4: Verify Services

Check that all services are running:

```bash
docker-compose ps
```

All services should show a "running" state. If any service is not running, check the logs:

```bash
docker-compose logs [service_name]
```

### Step 5: Configure Keycloak

1. Access the Keycloak admin console at `https://keycloak.your-domain.com/admin` (or `http://keycloak.localhost/admin` for local development)

2. Login with the admin credentials defined in your `.env` file

3. Confirm that the BEMED realm has been imported correctly

4. If needed, create a new client secret for the backend client:
   - Navigate to Clients > backend
   - Go to the Credentials tab
   - Copy the client secret and update your `.env` file

## Accessing the Application

After successful deployment, you can access:

- **Frontend Application**: `https://app.your-domain.com` or `http://app.localhost`
- **Backend API**: `https://api.your-domain.com` or `http://api.localhost`
- **API Documentation**: `https://api.your-domain.com/docs` or `http://api.localhost/docs`
- **Documentation**: `https://docs.your-domain.com` or `http://docs.localhost`
- **Keycloak Admin**: `https://keycloak.your-domain.com/admin` or `http://keycloak.localhost/admin`
- **PHPMyAdmin**: `https://phpmyadmin.your-domain.com` or `http://phpmyadmin.localhost`
- **Portainer**: `https://your-domain.com:9000` or `http://localhost:9000`
- **Traefik Dashboard**: `https://traefik.your-domain.com:8080` or `http://traefik.localhost:8080`

## Maintenance Tasks

### Updating the Application

To update to the latest version:

```bash
git pull  # If cloned from Git
docker-compose down
docker-compose build --no-cache  # Force rebuild of all images
docker-compose up -d
```

### Database Backup

Create a backup of the database:

```bash
docker exec -it database mysqldump -u root -p --all-databases > bemed_backup_$(date +%Y%m%d).sql
```

### Database Restore

Restore from a backup:

```bash
docker exec -it database mysql -u root -p < backup_file.sql
```

### Viewing Logs

To view logs for a specific service:

```bash
docker-compose logs -f [service_name]
```

Available services: `traefik`, `backend`, `frontend`, `keycloak`, `db`, `phpmyadmin`, `portainer`, `docs`

### Scaling Services

If needed, you can scale certain services:

```bash
docker-compose up -d --scale backend=3
```

This example scales the backend service to 3 instances. Note that additional configuration may be needed in Traefik.

## Security Recommendations

1. **Update Passwords**: Change all default passwords in the `.env` file
2. **Enable HTTPS**: Configure SSL certificates in Traefik
3. **Secure Admin Access**: Restrict access to admin interfaces (Keycloak, PHPMyAdmin, Portainer)
4. **Regular Updates**: Keep all services updated to their latest versions
5. **Firewall Configuration**: Restrict access to necessary ports only
6. **Database Security**: Ensure the database is not exposed to the public internet

## SSL/TLS Configuration

For production environments, configure SSL/TLS certificates using one of these methods:

### Option 1: Let's Encrypt (Recommended)

Update your Traefik configuration in `config/traefik/traefik.yaml` to include:

```yaml
certificatesResolvers:
  letsencrypt:
    acme:
      email: your-email@example.com
      storage: /etc/traefik/acme/acme.json
      httpChallenge:
        entryPoint: web
```

Then update your service labels in `docker-compose.yaml` to use the certificate resolver.

### Option 2: Manual Certificates

Place your certificates in a directory and mount it to the Traefik container.

## Troubleshooting

### Common Issues

1. **Service fails to start**
   - Check logs: `docker-compose logs [service_name]`
   - Verify environment variables are correctly set
   - Ensure ports are not already in use

2. **Authentication issues with Keycloak**
   - Check Keycloak logs: `docker-compose logs keycloak`
   - Verify realm import was successful
   - Check client configuration and secret

3. **Database connection errors**
   - Check database logs: `docker-compose logs db`
   - Verify database initialization scripts executed correctly
   - Check database credentials in service configurations

4. **Network issues**
   - Verify DNS settings if using a custom domain
   - Check Traefik configuration for routing rules
   - Ensure firewalls allow traffic on required ports

## Support and Resources

- **Documentation**: Access comprehensive documentation at `https://docs.your-domain.com`
- **Issue Tracking**: Report issues at the project's issue tracker
- **Community Support**: Join the community forums or chat for assistance

## Next Steps

After setting up the basic system, consider:

1. **User Management**: Configure user roles and permissions in Keycloak
2. **Customization**: Adjust the application to meet your specific requirements
3. **Monitoring**: Set up monitoring solutions for system health
4. **Backup Strategy**: Establish regular backup procedures
5. **Update Strategy**: Plan for regular updates and maintenance windows
